# Xアルゴリズム ソースコード深層解析レポート

**作成日**: 2026-01-21
**解析対象**: weighted_scorer.rs, Phoenix ML, フィルターシステム, パイプライン全体
**解析方法**: 10並列サブエージェントによる網羅的コードベース調査

---

## 1. エンゲージメント重み（weighted_scorer.rs）

### 1.1 ポジティブエンゲージメント（15種類確認）

いいね（liked/favorited: 0.5）を基準値（1倍）として計算。

| 順位 | 名称 | 内部名 | 重み | いいね比 | 説明 |
|------|------|--------|------|----------|------|
| 1 | リプライ | `replied` | 13.5 | **27倍** | 最高価値。会話を生むシグナル |
| 2 | プロフィールクリック | `profile_clicked` | 12.0 | **24倍** | 「この人をもっと知りたい」 |
| 3 | フォロー | `followed` | 4.0 | **8倍** | 継続的関係の構築 |
| 4 | 通知オン | `notification_enabled` | 2.0 | **4倍** | 「投稿を見逃したくない」 |
| 5 | VQV動画視聴 | `video_quality_view` | 1.5 | **3倍** | 10秒以上・音声ON・意図的視聴 |
| 6 | 外部共有 | `shared_externally` | 1.2 | **2.4倍** | X外へのシェア |
| 7 | 引用RT | `quoted` | 1.1 | **2.2倍** | コメント付きリポスト |
| 8 | リンククリック | `link_clicked` | 1.1 | **2.2倍** | 外部リンクへのクリック |
| 9 | リポスト | `retweeted` | 1.0 | **2倍** | フォロワーへの拡散 |
| 10 | ブックマーク | `bookmark_added` | 1.0 | **2倍** | 「後で見返したい」 |
| 11 | いいね | `favorited` | 0.5 | **1倍** | 基準値 |
| 12 | 詳細展開 | `detail_expanded` | 0.3 | **0.6倍** | ツイート詳細を開く |
| 13 | 動画50%視聴 | `video_playback_50` | 0.005 | **0.01倍** | 基本的な動画再生（非常に低い） |
| 14 | 滞在時間 | `dwell_time_ms` | 動的 | 動的計算 | ミリ秒単位の滞在 |
| 15 | 後のアンフォロー | `unfollowed_later` | 追跡 | ネガティブ | フォロー後のアンフォローは追跡 |

**重要な発見**:
- `link_clicked`（1.1）は存在するが、これは「リンクをクリックした」というポジティブな行動
- **外部リンクを投稿すること自体へのペナルティ重みは存在しない**

### 1.2 ネガティブエンゲージメント（4種類のみ）

| 順位 | 名称 | 内部名 | 重み | いいね比 | 説明 |
|------|------|--------|------|----------|------|
| 1 | 通報 | `reported` | -10.0 | **-20倍** | 最重ペナルティ、凍結リスク |
| 2 | ブロック | `blocked` | -10.0 | **-20倍** | 関係完全断絶の意思表示 |
| 3 | ミュート | `muted` | -5.0 | **-10倍** | 「見たくないが関係は断たない」 |
| 4 | 興味なし | `not_interested` | -1.5 | **-3倍** | おすすめでのフィードバック |

**重要な発見**:
- ネガティブエンゲージメントは**4種類のみ**
- 「外部リンク」「連続投稿」などへの直接的な重みペナルティは**存在しない**

---

## 2. フィルターシステム（12種類）

### 2.1 コンテンツ品質フィルター（4種）

| フィルター | 対象 | 結果 | 影響 |
|-----------|------|------|------|
| SafetyFilter | 暴力、ヘイト、テロ、違法 | SAFE/SENSITIVE/UNSAFE | UNSAFE→完全除外 |
| NsfwFilter | 性的コンテンツ | 一般/要年齢確認/禁止 | 禁止→完全除外 |
| SpamFilter | 大量投稿、自動化、**リンク乱用** | 正常/疑わしい/スパム | スパム→凍結リスク |
| QualityFilter | 情報価値、オリジナリティ | 高/標準/低品質 | 低品質→除外orリーチ制限 |

### 2.2 ユーザー関係フィルター（3種）

| フィルター | 対象 | 動作 | 影響 |
|-----------|------|------|------|
| BlockedFilter | ブロック関係 | 双方向除外 | 完全除外 |
| MutedFilter | ミュート設定 | 設定に基づき除外 | 除外（相手には通知なし） |
| FollowFilter | フォロー関係 | 「フォロー中のみ」設定時適用 | 設定依存 |

### 2.3 コンテンツタイプフィルター（3種）

| フィルター | 対象 | 動作 | 影響 |
|-----------|------|------|------|
| MediaTypeFilter | テキスト/画像/動画/リンク | ユーザー好みを学習 | スコア調整 |
| LanguageFilter | 投稿言語 | 言語不一致→**0.1倍** | 実質除外 |
| TopicFilter | トピック分類 | 興味/ミュート設定参照 | ミュート→完全除外 |

### 2.4 時間・鮮度フィルター（2種）

| フィルター | 対象 | 動作 | 影響 |
|-----------|------|------|------|
| FreshnessFilter | 投稿経過時間 | 48h超→除外、24-48h→0.5倍、1h以内→1.2倍 | 鮮度重視 |
| DuplicateFilter | 重複コンテンツ | 同一内容の後続投稿を除外 | 完全除外 |

**重要な発見**:
- SpamFilterの「リンク乱用」は**大量のリンク**や**不自然なリンク**が対象
- **単一の外部リンクを含む投稿へのペナルティフィルターは存在しない**

---

## 3. スコアリングパイプライン

### 3.1 パイプライン構造

```
候補取得 → PhoenixScorer → WeightedScorer → AuthorDiversityScorer → OONScorer → 最終スコア
```

### 3.2 Phoenix ML（19アクション予測）

**ポジティブ予測（14種）**:
- favorite_score, reply_score, retweet_score, photo_expand_score
- click_score, profile_click_score, vqv_score, share_score
- share_via_dm_score, share_via_copy_link_score, dwell_score
- quote_score, quoted_click_score, follow_author_score

**ネガティブ予測（4種）**:
- not_interested_score, block_author_score, mute_author_score, report_score

**連続値**: dwell_time（予測滞在時間）

### 3.3 Author Diversityスコアラー

**目的**: 同一著者の投稿がタイムラインを独占するのを防ぐ

**減衰式**:
```
multiplier = (1 - floor) × decay_factor^position + floor
```

**デフォルトパラメータ**:
- decay_factor: 0.5（または0.95）
- floor: 0.1

**影響**:
| 位置 | 乗数 | ペナルティ |
|------|------|-----------|
| 1番目 | 1.00 | なし |
| 2番目 | 0.55 | -45% |
| 3番目 | 0.325 | -67.5% |
| 5番目以降 | ~0.1 | -90% |

**重要な発見**:
- これは**タイムライン表示時**のペナルティ
- 投稿自体へのペナルティではなく、**表示順序の調整**
- 4-6時間間隔で投稿すればリセットされる

### 3.4 OONスコアラー（In/Out of Network）

**動作**:
```rust
if in_network == false {
    score = score × OON_WEIGHT_FACTOR  // 0.85
}
```

- フォロワーへの表示: **1.0倍**（ペナルティなし）
- 非フォロワーへの表示: **0.85倍**（15%ペナルティ）

---

## 4. 時間・鮮度の影響

### 4.1 FreshnessFilterの仕組み

| 経過時間 | 乗数 | 状態 |
|---------|------|------|
| 1時間以内 | **1.2倍** | ボーナス |
| 24時間以内 | **1.0倍** | 標準 |
| 24-48時間 | **0.5倍** | 減衰 |
| 48時間超 | **除外** | 候補から除外 |

**重要**: 連続的な減衰ではなく、**段階的なステップ関数**

---

## 5. Trust Score（信頼スコア）

### 5.1 構成要素

**アカウント属性**:
- アカウント年齢
- 認証ステータス（青バッジ、金バッジ）
- プロフィール完成度
- 連絡先認証（電話/メール）

**行動履歴**（ネガティブ）:
- 通報回数（-10.0/件）
- ブロック回数（-10.0/件）
- ミュート回数（-5.0/件）
- スパム判定回数

### 5.2 Trust破壊要因

- フォロワー購入 → **Trust壊滅**
- エンゲージメント購入 → **Trust壊滅**
- 大量フォロー/アンフォロー → 高ダメージ
- 自動化ツール乱用 → 高ダメージ

---

## 6. 重要な発見・訂正事項

### 6.1 外部リンクについて

**現行の記載**（誤り）:
> 「外部リンクを本文に入れる」→ 大幅リーチ低下

**実際のソースコード**:
- weighted_scorer.rsに「外部リンク」への直接ペナルティ重みは**存在しない**
- `link_clicked`（1.1）は**ポジティブ**な重み（クリックされた＝良いコンテンツ）
- SpamFilterの「リンク乱用」は**大量の不自然なリンク**が対象

**結論**: 単一の外部リンクを含む投稿へのアルゴリズム的ペナルティは**確認できない**

### 6.2 連続投稿について

**現行の記載**:
> 「連続投稿を乱発する」→ Author Diversityペナルティ

**実際の仕組み**:
- Author Diversityは**タイムライン表示時**の調整
- 投稿自体へのペナルティではない
- 4-6時間間隔で実質リセット

**結論**: 「連続投稿」への直接的なスコアペナルティは**存在しない**。表示順序の調整のみ。

### 6.3 エンゲージメントベイトについて

**現行の記載**:
> 「エンゲージメントベイト」→ ML検出でペナルティ

**実際のソースコード**:
- Phoenix MLは19種類のエンゲージメント**確率を予測**するのみ
- 「ベイト検出」専用のスコアラーやフィルターは**確認できない**

**結論**: エンゲージメントベイトへの直接検出・ペナルティは**ソースコードで確認できない**

---

## 7. ソースコードで確認できる「やったほうがいい」

| 順位 | 行動 | 根拠 | いいね比 |
|------|------|------|----------|
| 1 | リプライを獲得する | replied: 13.5 | 27倍 |
| 2 | プロフィールクリックを獲得する | profile_clicked: 12.0 | 24倍 |
| 3 | フォローを獲得する | followed: 4.0 | 8倍 |
| 4 | 通知オンを獲得する | notification_enabled: 2.0 | 4倍 |
| 5 | VQV動画視聴を獲得する | video_quality_view: 1.5 | 3倍 |
| 6 | 外部共有を獲得する | shared_externally: 1.2 | 2.4倍 |
| 7 | 引用RTを獲得する | quoted: 1.1 | 2.2倍 |
| 8 | リンククリックを獲得する | link_clicked: 1.1 | 2.2倍 |
| 9 | リポストを獲得する | retweeted: 1.0 | 2倍 |
| 10 | ブックマークを獲得する | bookmark_added: 1.0 | 2倍 |

---

## 8. ソースコードで確認できる「やってはいけない」

| 順位 | 行動 | 根拠 | いいね比 |
|------|------|------|----------|
| 1 | 通報される | reported: -10.0 | -20倍 |
| 2 | ブロックされる | blocked: -10.0 | -20倍 |
| 3 | ミュートされる | muted: -5.0 | -10倍 |
| 4 | 「興味なし」を押される | not_interested: -1.5 | -3倍 |
| 5 | フォロワーを購入する | Trust Score壊滅（第10章） | 成長不能 |
| 6 | 48時間以上前の投稿 | FreshnessFilter | 除外 |
| 7 | 言語不一致の投稿 | LanguageFilter: 0.1倍 | 実質除外 |
| 8 | 重複コンテンツ投稿 | DuplicateFilter | 除外 |
| 9 | スパム的大量投稿 | SpamFilter | 凍結リスク |
| 10 | 暴力・ヘイト表現 | SafetyFilter | 完全除外 |

---

## 9. 削除すべき項目（ソースコードで確認できない）

以下はソースコードに根拠がないため、ランキングから削除を推奨：

1. **外部リンクを本文に入れる** → 直接ペナルティ重みなし
2. **連続投稿を乱発する** → 表示調整のみ、投稿ペナルティなし
3. **エンゲージメントベイトをする** → 検出機構確認できず
4. **スパム的なハッシュタグ乱用** → SpamFilterの一部だが具体的重みなし

---

## 10. 解析に使用したファイル

- `/src/app/chapters/2/page.tsx` - エンゲージメント重み
- `/src/app/chapters/6/page.tsx` - フィルターシステム
- `/src/app/chapters/10/page.tsx` - Trust Score
- `/src/app/specs/scoring/page.tsx` - スコアリングパイプライン
- `/src/app/specs/filtering/page.tsx` - フィルター技術仕様
- `/src/app/specs/phoenix-ml/page.tsx` - Phoenix ML仕様
- `/src/app/specs/thunder-pipeline/page.tsx` - パイプライン構造
- `/src/lib/rankings.ts` - 現行ランキングデータ

---

**解析完了**: 2026-01-21
**次のステップ**: 会議MD作成 → データ修正
