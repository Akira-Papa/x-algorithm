# 第3章：Two-Tower検索とコンテンツ発見

## 3.1 Two-Towerとは何か

Two-Tower（二塔）検索は、ユーザーとコンテンツをマッチングするための技術です。名前の通り、2つの「塔」（Tower）で構成されています。

```
【Two-Tower アーキテクチャ概念図】

┌─────────────────┐          ┌─────────────────┐
│                 │          │                 │
│   User Tower    │          │  Content Tower  │
│   （ユーザー塔） │          │ （コンテンツ塔）│
│                 │          │                 │
│  あなたは      │          │  この投稿は    │
│  どんな人？    │          │  どんな内容？  │
│                 │          │                 │
└────────┬────────┘          └────────┬────────┘
         │                            │
         │  128次元ベクトル           │  128次元ベクトル
         │                            │
         └──────────┬─────────────────┘
                    │
                    ↓
            ┌──────────────┐
            │              │
            │ コサイン類似度 │
            │    計算      │
            │              │
            └──────────────┘
                    │
                    ↓
            類似度スコア: 0.0 〜 1.0
            （高いほどマッチ）
```

この仕組みにより、Xは「あなたが興味を持ちそうなコンテンツ」を、あなたがフォローしていない人の投稿からも見つけ出すことができます。

Two-Tower検索は主に「おすすめ」タブ（For You）や「発見」機能で使用されます。フォローしていない人の投稿があなたのタイムラインに表示されるのは、この仕組みのおかげです。

---

## 3.2 User Tower：あなたはどんな人？

User Tower（ユーザー塔）は、あなた自身を数値化（ベクトル化）するシステムです。

### 入力される情報

```
【User Towerが分析する情報】

1. 過去の行動履歴
   ├── いいねした投稿の傾向
   ├── リプライした相手と内容
   ├── リポストしたコンテンツ
   ├── 滞在時間が長かった投稿
   └── クリックしたリンク・プロフィール

2. フォローパターン
   ├── フォローしているアカウントの属性
   ├── フォロー/アンフォローの傾向
   ├── 通知をオンにしているアカウント
   └── ミュート/ブロックしているアカウント

3. 興味カテゴリ
   ├── よく反応するトピック
   ├── 検索キーワード履歴
   ├── 参加しているコミュニティ
   └── 反応しないトピック（除外要因）

4. メタ情報
   ├── 使用言語
   ├── 活動時間帯
   ├── 使用デバイス
   └── 地理的情報（概算）
```

### ベクトル化のプロセス

これらの情報は、128次元の数値ベクトルに変換されます。

```
【ユーザーベクトルのイメージ】

あなた = [0.23, -0.15, 0.87, 0.42, ..., 0.31]
         ↑      ↑      ↑      ↑           ↑
         |      |      |      |           |
     技術への  政治への スタートアップ デザイン   ...
     興味度   興味度   への興味度   への興味度

※ 実際の次元は意味づけされていない（学習で自動決定）
```

重要なのは、このベクトルは**常に更新される**ということです。あなたが今日いいねした投稿、リプライした内容、プロフィールを見に行ったアカウント——これらすべてが、リアルタイムであなたのUser Towerベクトルに反映されます。

---

## 3.3 Content Tower：これはどんなコンテンツ？

Content Tower（コンテンツ塔）は、各投稿を数値化するシステムです。

### 入力される情報

```
【Content Towerが分析する情報】

1. ツイート内容
   ├── テキストの意味（自然言語処理）
   ├── 使用されているキーワード
   ├── ハッシュタグ
   ├── メンション（@）
   └── 言語

2. メディア情報
   ├── 画像の内容（画像認識）
   ├── 動画のテーマ・長さ
   ├── リンク先の内容
   └── 添付ファイルの種類

3. 著者情報
   ├── 著者のフォロワー数・影響力
   ├── 著者の専門分野
   ├── 著者の過去の投稿傾向
   └── 著者のエンゲージメント率

4. エンゲージメント履歴
   ├── これまでの反応数・率
   ├── どんなユーザーが反応したか
   ├── 反応のパターン（急速拡散？じわじわ？）
   └── ネガティブ反応の有無
```

### ベクトル化のプロセス

投稿もまた、128次元のベクトルに変換されます。

```
【コンテンツベクトルのイメージ】

投稿A = [0.45, -0.08, 0.92, 0.38, ..., 0.27]
        ↑      ↑      ↑      ↑           ↑
        |      |      |      |           |
    技術的   政治的  スタートアップ デザイン   ...
    な内容   な内容  関連の内容   関連の内容
```

---

## 3.4 マッチング：コサイン類似度計算

User TowerとContent Towerで生成された2つのベクトルは、**コサイン類似度**という指標で比較されます。

### コサイン類似度とは

```
【コサイン類似度の直感的理解】

2つのベクトルを「矢印」として考える

完全一致（類似度 = 1.0）
    →→→  同じ方向を向いている
    →→→  = 完全にマッチ

直交（類似度 = 0.0）
    →→→
      ↑   90度異なる方向
      ↑   = 関連性なし
      ↑

逆向き（類似度 = -1.0）
    →→→
    ←←←  正反対の方向
          = 完全に不一致
```

### 計算例

```
【類似度計算のイメージ】

あなたのベクトル:
[技術:0.9, 政治:0.1, スタートアップ:0.8, デザイン:0.3, ...]

投稿Aのベクトル:
[技術:0.85, 政治:0.05, スタートアップ:0.9, デザイン:0.4, ...]
→ 類似度: 0.95（非常に高い）→ おすすめに表示

投稿Bのベクトル:
[技術:0.1, 政治:0.9, スタートアップ:0.1, デザイン:0.05, ...]
→ 類似度: 0.15（低い）→ おすすめに表示されにくい
```

---

## 3.5 発見タブで見つけてもらう戦略

Two-Towerの仕組みを理解した上で、「発見」されやすくなる戦略を考えましょう。

### 戦略1：明確なニッチを持つ

```
【ニッチの重要性】

悪い例: 「マーケティング全般」
├── ベクトルが分散
├── どのクラスタにも強く属さない
└── マッチングスコアが中途半端

良い例: 「SaaSのPLG戦略」
├── ベクトルが特定方向に集中
├── 同じ興味を持つユーザークラスタと強くマッチ
└── 高い類似度スコアを獲得
```

**実践**: あなたの専門分野を3つ以内に絞り、投稿の80%をその分野に集中させましょう。

### 戦略2：一貫したコンテンツテーマ

```
【一貫性の効果】

投稿ごとにテーマがバラバラ
├── Content Towerのベクトルが毎回異なる
├── アルゴリズムが「この人は何の専門家？」を学習できない
└── 発見されにくい

テーマが一貫している
├── Content Towerのベクトルが安定
├── アルゴリズムが専門性を認識
└── 関連するユーザーに推薦されやすい
```

**実践**: 毎日の投稿で、同じキーワードやトピックを繰り返し使用しましょう。

### 戦略3：ターゲット層との相互作用

```
【相互作用の効果】

一方的に投稿するだけ
├── User Towerの「関係性」情報が薄い
├── 類似ユーザークラスタへの接続が弱い
└── 発見経路が限られる

ターゲット層のコンテンツにリプライ・引用RT
├── User Towerに「この人はこの界隈の人」という情報が追加
├── 類似ユーザークラスタとの接続が強化
└── そのクラスタのユーザーに発見されやすくなる
```

**実践**: 見つけてほしい層が反応しそうなアカウントを10個リストアップし、定期的にリプライや引用RTで関わりましょう。

### 戦略4：エンゲージメントの質を高める

```
【エンゲージメント質の効果】

いいねは多いが、リプライが少ない
├── Content Towerの「エンゲージメント履歴」が薄い
├── 「反応はあるが会話は生まない」と学習される
└── 推薦優先度が下がる

リプライやプロフィールクリックが多い
├── 「この投稿は深い関与を生む」と学習される
├── 類似ユーザーへの推薦優先度が上がる
└── 発見タブでの露出が増加
```

**実践**: 第2章で学んだ「リプライ誘発」「プロフィール誘導」のテクニックを活用しましょう。

---

## 3.6 Two-Towerの限界と注意点

Two-Towerにも限界があります。

```
【Two-Towerの限界】

1. コールドスタート問題
   ├── 新規アカウントはUser Tower情報が少ない
   ├── 新規投稿はContent Tower情報が少ない
   └── → 最初は発見されにくい

2. フィルターバブル
   ├── 類似コンテンツばかり推薦される
   ├── 新しい分野への拡張が難しい
   └── → 意図的な多様性確保が必要

3. 短期的な興味への偏り
   ├── 直近の行動が重視される
   ├── 一時的な興味が長期的な推薦に影響
   └── → 慎重な行動が必要
```

---

## 3.7 この章のまとめ

```
【第3章 重要ポイント】

✓ Two-Towerはユーザーとコンテンツをマッチングする仕組み
  → User Tower + Content Tower + コサイン類似度

✓ User Towerはあなたの行動・興味を128次元ベクトル化
  → リアルタイムで更新される

✓ Content Towerは投稿の内容・著者・反応を128次元ベクトル化
  → 投稿ごとに計算される

✓ 発見されるには「明確なニッチ」と「一貫性」が重要
  → ベクトルの方向を安定させる
```

```
【今日からできること】

□ 自分の専門分野を3つ以内に絞る
□ 投稿の80%を専門分野に集中させる
□ ターゲット層のアカウント10個をリストアップ
□ 毎日、ターゲット層のコンテンツにリプライする
```

---

**次章予告**: 第4章では、実際にスコアを計算するPhoenix MLモデルの内部構造を解説します。機械学習がどのようにあなたの投稿を評価しているのか、その仕組みが明らかになります。

---

[← 第2章に戻る](./chapter-02-engagement.md) | [目次](./README.md) | [第4章へ進む →](./chapter-04-phoenix.md)
