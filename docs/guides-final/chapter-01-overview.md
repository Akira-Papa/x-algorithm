# 第1章：Xアルゴリズムの全体像と思想

## 1.1 なぜアルゴリズムを理解すべきか

あなたがXを開くたびに、画面には何百万もの投稿の中から選ばれた数十件だけが表示されます。この「選別」を行っているのが、推薦アルゴリズムです。

多くの人は、Xのタイムラインを「フォローしている人の投稿が時系列で流れてくる場所」だと考えています。しかし現実は大きく異なります。Xは2016年から、機械学習を用いた推薦システムを導入しており、あなたが見る投稿は、高度なアルゴリズムによって厳選されたものです。

2023年3月、イーロン・マスク氏の決定により、Xの推薦アルゴリズムがオープンソースとして公開されました。これにより、私たちは初めて「なぜある投稿が広く表示され、別の投稿が埋もれるのか」を技術的に理解できるようになりました。

本書は、2026年1月時点で公開されているXの推薦アルゴリズムのオープンソースコードを徹底解析し、アルゴリズムの仕組みを実践的な戦略に落とし込んだガイドです。

---

## 1.2 Xの設計思想：滞在時間の最大化

Xの推薦アルゴリズムには、明確な設計思想があります。それは**「ユーザーの滞在時間を最大化する」**ことです。

これは単純な「いいねが多い投稿を上に表示する」というものではありません。アルゴリズムは以下を予測しています：

```
【アルゴリズムが予測していること】

1. この投稿を見たら、ユーザーはどんな反応をするか？
   - いいねするか？
   - リプライするか？
   - 詳細を開くか？
   - プロフィールを見に行くか？

2. この投稿を見た後、ユーザーは何をするか？
   - Xを続けて使うか？
   - 別のアプリに移るか？
   - 満足して閉じるか？

3. この投稿は、ユーザーの長期的な満足に貢献するか？
   - フォローにつながるか？
   - 通知をオンにするか？
   - それともミュート・ブロックされるか？
```

つまり、アルゴリズムは「今この瞬間の反応」だけでなく、「この投稿がユーザーの行動にどう影響するか」までを予測しているのです。

この理解は極めて重要です。なぜなら、多くの人が追いかけている「いいね数」や「インプレッション数」は、アルゴリズムにとっては多くの評価指標の一つに過ぎないからです。

---

## 1.3 3層アーキテクチャの全体像

Xの推薦システムは、3つの主要コンポーネントで構成されています。

```
【X推薦システム 3層アーキテクチャ】

┌─────────────────────────────────────────────────────────┐
│                 Home Mixer（Rust）                       │
│                                                         │
│  役割：リクエストの受付と最終的なタイムライン組み立て      │
│  - ユーザーリクエストを受信                              │
│  - 各コンポーネントの結果を統合                          │
│  - 最終的なタイムラインを構築して返却                    │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│                  Thunder（Rust）                         │
│                                                         │
│  役割：8段階のパイプライン処理                           │
│  - 候補生成（Candidate Generation）                      │
│  - フィルタリング（12種類のフィルター）                  │
│  - スコアリング（複数のスコアラー）                      │
│  - ランキング（最終順位決定）                            │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│               Phoenix（Python/JAX）                      │
│                                                         │
│  役割：機械学習によるエンゲージメント予測                │
│  - Grok Transformerモデル                               │
│  - 19種類のエンゲージメント確率を予測                    │
│  - ユーザー・コンテンツ・著者の特徴量を統合              │
└─────────────────────────────────────────────────────────┘
```

### Home Mixer：オーケストラの指揮者

Home Mixerは、ユーザーがXを開いた瞬間にリクエストを受け取る「入口」です。Rustで書かれた高速なサービスで、各コンポーネントに処理を依頼し、結果を統合してタイムラインを構築します。

### Thunder：パイプラインの実行者

Thunderは、推薦処理の中核を担うコンポーネントです。候補となる投稿を集め、フィルタリングし、スコアリングし、最終的な順位を決定します。8段階のパイプラインを通じて、数百万の候補から数十件の「あなたに最適な投稿」を選び出します。

### Phoenix：予測の頭脳

Phoenixは、機械学習モデルを用いてエンゲージメント予測を行うコンポーネントです。「この投稿を見たユーザーは、いいねするか？リプライするか？フォローするか？」といった19種類の行動確率を予測します。

---

## 1.4 8段階パイプラインの流れ

Thunderが実行する8段階のパイプラインを詳しく見ていきましょう。

```
【8段階パイプライン】

Stage 1: Candidate Source Selection
└─ どこから候補を集めるかを決定
   - フォロー中のユーザーの投稿
   - おすすめの投稿（OON: Out of Network）
   - トレンドトピック

Stage 2: Candidate Retrieval
└─ 候補となる投稿を大量に取得
   - 数十万〜数百万の候補
   - Two-Tower検索による類似コンテンツ発見

Stage 3: Pre-Filtering
└─ 明らかに不適切な候補を除外
   - ブロック・ミュート関係
   - 安全性フィルター
   - 言語フィルター

Stage 4: Feature Extraction
└─ 各候補の特徴量を抽出
   - ツイートの内容、メディア、著者情報
   - ユーザーとの関係性
   - 過去のエンゲージメント履歴

Stage 5: ML Scoring (Phoenix)
└─ 機械学習による予測スコアリング
   - 19種類のエンゲージメント確率予測
   - Grok Transformerモデルによる推論

Stage 6: Post-Filtering
└─ スコア後の品質フィルタリング
   - 重複排除
   - 著者多様性確保
   - 品質基準チェック

Stage 7: Ranking
└─ 最終的な順位決定
   - 複数スコアの統合
   - ビジネスルールの適用

Stage 8: Blending & Serving
└─ 最終タイムラインの構築
   - 広告の挿入位置決定
   - キャッシュと配信
```

この8段階のパイプラインは、1リクエストあたり数百ミリ秒で処理されます。あなたがXを開くたびに、このすべての処理が裏側で実行されているのです。

---

## 1.5 オープンソース化と透明性

2023年3月31日、イーロン・マスク氏のツイートとともに、Xの推薦アルゴリズムがGitHubで公開されました。

公開されたリポジトリには以下が含まれています：

```
【公開されたコンポーネント】

├── home-mixer/          # Home Mixer（Scala→Rust移行中）
├── thunder/             # Thunder パイプライン（Rust）
├── phoenix/             # Phoenix MLモデル（Python/JAX）
└── candidate-pipeline/  # 候補生成パイプライン
```

ただし、すべてが公開されているわけではありません：

```
【非公開の要素】

- 学習済みモデルの重み（パラメータ）
- 実際の特徴量定義の一部
- インフラストラクチャの詳細
- リアルタイムで更新される閾値
```

つまり、私たちが見ることができるのは「システムの設計図」であり、「学習された知識」ではありません。しかし、設計図だけでも、アルゴリズムがどのように動作するかを深く理解することは可能です。

---

## 1.6 この章のまとめ

```
【第1章 重要ポイント】

✓ Xのアルゴリズムは「滞在時間最大化」を目指している
  → 単純ないいね数ではなく、ユーザー行動全体を予測

✓ 3層アーキテクチャで構成されている
  → Home Mixer（受付）→ Thunder（処理）→ Phoenix（予測）

✓ 8段階のパイプラインで投稿が選別される
  → 候補収集 → フィルタリング → スコアリング → ランキング

✓ 2023年にオープンソース化された
  → 設計図は公開、学習済みパラメータは非公開
```

---

**次章予告**: 第2章では、アルゴリズムの中核である「19種類のエンゲージメント」とその重み付けを詳しく解説します。なぜリプライがいいねの27倍重要なのか、その理由が明らかになります。

---

[← 目次に戻る](./README.md) | [第2章へ進む →](./chapter-02-engagement.md)
